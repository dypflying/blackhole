<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Worker Test</title>
</head>
<body>
    <h1>Web Worker Test</h1>
    <button id="testBtn">Test Worker</button>
    <pre id="output"></pre>
    
    <script>
        const output = document.getElementById('output');
        
        function log(msg) {
            output.textContent += msg + '\n';
            console.log(msg);
        }
        
        document.getElementById('testBtn').addEventListener('click', () => {
            output.textContent = '';
            log('Testing Worker...');
            
            try {
                const worker = new Worker('raytracer-worker.js');
                log('✓ Worker created successfully');
                
                worker.onerror = (e) => {
                    log(`✗ Worker error: ${e.message} at ${e.filename}:${e.lineno}`);
                };
                
                worker.onmessage = (e) => {
                    log(`✓ Worker responded: ${JSON.stringify(e.data).substring(0, 200)}`);
                    worker.terminate();
                    log('✓ Worker terminated');
                };
                
                const testData = {
                    type: 'trace',
                    data: {
                        width: 10,
                        height: 10,
                        camPos: { x: 2e11, y: 0, z: 0 },
                        camTarget: { x: 0, y: 0, z: 0 },
                        blackHoleRs: 1.269e10,
                        objects: [],
                        disk: { r1: 2.79e10, r2: 6.6e10 },
                        maxSteps: 100,
                        startRow: 0,
                        endRow: 10
                    }
                };
                
                log('Sending test data to worker...');
                worker.postMessage(testData);
                
            } catch (err) {
                log(`✗ Exception: ${err.message}`);
            }
        });
    </script>
</body>
</html>
